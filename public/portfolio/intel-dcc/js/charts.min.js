!function(){"use strict";IntelDCC.charts={instances:[]},IntelDCC.charts.downloadSensorData=function(t,a,e,r,n,s,l){return new Promise(function(c,h){$.post("api/get-sensor-data.php",{groupID:t,deviceID:a,sensorID:e,period:r,interval:n,fromTimestamp:s,toTimestamp:l},function(t){c(t)})})},IntelDCC.charts.drawChart=function(t,a){var e=$(a).closest("[data-responsive-chart]"),r=$(a).attr("data-chart-id"),n=[],s=[],l=a.getContext("2d");$(e).find("[data-chart-title]").text(t.description);var c=moment.unix(t.data[0].date).format("DDDD"),h=moment.unix(t.data[t.data.length-1].date).format("DDDD"),i="HH:mm",o=Math.abs(c-h);o>14?i="DD-MM-YY":o>1&&(i="Do - "+i);for(var C=0;C<t.data.length;C++)n.push(moment.unix(t.data[C].date).format(i)),s.push(t.data[C].value);n=IntelDCC.charts.pruneChartLabels(n);var d={animation:!1,responsive:!0,barValueSpacing:1,barShowStroke:!1,scaleBeginAtZero:!0,scaleLabel:'<%= " " + value %>'},D=null;"RAINFALL"===IntelDCC.getSensorType(t.sensorID)?D=IntelDCC.charts.calculateChartScale(s,.2):"RIVER_LEVEL"===IntelDCC.getSensorType(t.sensorID)&&(D=IntelDCC.charts.calculateChartScale(s,1)),D&&(d.scaleOverride=!0,d.scaleSteps=D.steps,d.scaleStepWidth=D.width),t.data.length>200&&(d.scaleShowVerticalLines=!1);var u={labels:n,datasets:[{data:s,fillColor:"rgba(151, 187, 205, 1)",highlightFill:"rgba(151, 187, 205, 1)"}]};r?IntelDCC.charts.instances[r].destroy():(r=(new Date).valueOf(),$(a).attr("data-chart-id",r)),$(a).css("width","100%"),$(a).css("height","100%"),IntelDCC.charts.instances[r]=new Chart(l).Bar(u,d)},IntelDCC.charts.pruneChartLabels=function(t){var a=1,e=30;for(t=t.reverse();t.length>=e*a;)a+=1;for(var r=0;r<t.length;r++)0!==r&&r%a!==0&&(t[r]="");return t.reverse()},IntelDCC.charts.calculateChartScale=function(t,a){for(var e=1,r=a,n=0;n<t.length;n++)for(;t[n]>=r;)r+=a,e+=1;return e>15?IntelDCC.charts.calculateChartScale(t,2*a):{steps:e,width:a}},IntelDCC.charts.deg2rad=function(t){return t*(Math.PI/180)},IntelDCC.charts.getDistanceBetweenLatLngs=function(t,a,e,r){var n=6371,s=IntelDCC.charts.deg2rad(e-t),l=IntelDCC.charts.deg2rad(r-a),c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(IntelDCC.charts.deg2rad(t))*Math.cos(IntelDCC.charts.deg2rad(e))*Math.sin(l/2)*Math.sin(l/2),h=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i=n*h;return i}}();