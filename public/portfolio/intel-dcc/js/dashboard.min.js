function ClusterIcon(e,t){e.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.cluster_=e,this.className_=e.getMarkerClusterer().getClusterClass(),this.styles_=t,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(e.getMap())}function Cluster(e){this.markerClusterer_=e,this.map_=e.getMap(),this.gridSize_=e.getGridSize(),this.minClusterSize_=e.getMinimumClusterSize(),this.averageCenter_=e.getAverageCenter(),this.hideLabel_=e.getHideLabel(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,e.getStyles())}function MarkerClusterer(e,t,i){this.extend(MarkerClusterer,google.maps.OverlayView),t=t||[],i=i||{},this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.gridSize_=i.gridSize||60,this.minClusterSize_=i.minimumClusterSize||2,this.maxZoom_=i.maxZoom||null,this.styles_=i.styles||[],this.title_=i.title||"",this.zoomOnClick_=!0,void 0!==i.zoomOnClick&&(this.zoomOnClick_=i.zoomOnClick),this.averageCenter_=!1,void 0!==i.averageCenter&&(this.averageCenter_=i.averageCenter),this.ignoreHidden_=!1,void 0!==i.ignoreHidden&&(this.ignoreHidden_=i.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==i.enableRetinaIcons&&(this.enableRetinaIcons_=i.enableRetinaIcons),this.hideLabel_=!1,void 0!==i.hideLabel&&(this.hideLabel_=i.hideLabel),this.imagePath_=i.imagePath||MarkerClusterer.IMAGE_PATH,this.imageExtension_=i.imageExtension||MarkerClusterer.IMAGE_EXTENSION,this.imageSizes_=i.imageSizes||MarkerClusterer.IMAGE_SIZES,this.calculator_=i.calculator||MarkerClusterer.CALCULATOR,this.batchSize_=i.batchSize||MarkerClusterer.BATCH_SIZE,this.batchSizeIE_=i.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE,this.clusterClass_=i.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(t,!0),this.setMap(e)}function InfoBox(e){e=e||{},google.maps.OverlayView.apply(this,arguments),this.content_=e.content||"",this.disableAutoPan_=e.disableAutoPan||!1,this.maxWidth_=e.maxWidth||0,this.pixelOffset_=e.pixelOffset||new google.maps.Size(0,0),this.position_=e.position||new google.maps.LatLng(0,0),this.zIndex_=e.zIndex||null,this.boxClass_=e.boxClass||"infoBox",this.boxStyle_=e.boxStyle||{},this.closeBoxMargin_=e.closeBoxMargin||"2px",this.closeBoxURL_=e.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===e.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=e.infoBoxClearance||new google.maps.Size(1,1),"undefined"==typeof e.visible&&("undefined"==typeof e.isHidden?e.visible=!0:e.visible=!e.isHidden),this.isHidden_=!e.visible,this.alignBottom_=e.alignBottom||!1,this.pane_=e.pane||"floatPane",this.enableEventPropagation_=e.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}ClusterIcon.prototype.onAdd=function(){var e,t,i=this;this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){t=e}),google.maps.event.addDomListener(this.div_,"mousedown",function(){e=!0,t=!1}),google.maps.event.addDomListener(this.div_,"click",function(s){if(e=!1,!t){var a,n,r=i.cluster_.getMarkerClusterer();google.maps.event.trigger(r,"click",i.cluster_),google.maps.event.trigger(r,"clusterclick",i.cluster_),r.getZoomOnClick()&&(n=r.getMaxZoom(),a=i.cluster_.getBounds(),r.getMap().fitBounds(a),setTimeout(function(){r.getMap().fitBounds(a),null!==n&&r.getMap().getZoom()>n&&r.getMap().setZoom(n+1)},100)),s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){var e=i.cluster_.getMarkerClusterer();google.maps.event.trigger(e,"mouseover",i.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){var e=i.cluster_.getMarkerClusterer();google.maps.event.trigger(e,"mouseout",i.cluster_)})},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.draw=function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px",this.div_.style.left=e.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var e="",t=this.backgroundPosition_.split(" "),i=parseInt(t[0].trim(),10),s=parseInt(t[1].trim(),10),a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),e="<img src='"+this.url_+"' style='position: absolute; top: "+s+"px; left: "+i+"px; ",e+=this.cluster_.getMarkerClusterer().enableRetinaIcons_?"width: "+this.width_+"px;height: "+this.height_+"px;":"clip: rect("+-1*s+"px, "+(-1*i+this.width_)+"px, "+(-1*s+this.height_)+"px, "+-1*i+"px);",e+="'>",this.div_.innerHTML=e+"<div style='position: absolute;top: "+this.anchorText_[0]+"px;left: "+this.anchorText_[1]+"px;color: "+this.textColor_+";font-size: "+this.textSize_+"px;font-family: "+this.fontFamily_+";font-weight: "+this.fontWeight_+";font-style: "+this.fontStyle_+";text-decoration: "+this.textDecoration_+";text-align: center;width: "+this.width_+"px;line-height:"+this.height_+"px;'>"+(this.cluster_.hideLabel_?" ":this.sums_.text)+"</div>",this.div_.title="undefined"==typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.useStyle=function(e){this.sums_=e;var t=Math.max(0,e.index-1);t=Math.min(this.styles_.length-1,t);var i=this.styles_[t];this.url_=i.url,this.height_=i.height,this.width_=i.width,this.anchorText_=i.anchorText||[0,0],this.anchorIcon_=i.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=i.textColor||"black",this.textSize_=i.textSize||11,this.textDecoration_=i.textDecoration||"none",this.fontWeight_=i.fontWeight||"bold",this.fontStyle_=i.fontStyle||"normal",this.fontFamily_=i.fontFamily||"Arial,sans-serif",this.backgroundPosition_=i.backgroundPosition||"0 0"},ClusterIcon.prototype.setCenter=function(e){this.center_=e},ClusterIcon.prototype.createCss=function(e){var t=[];return t.push("cursor: pointer;"),t.push("position: absolute; top: "+e.y+"px; left: "+e.x+"px;"),t.push("width: "+this.width_+"px; height: "+this.height_+"px;"),t.join("")},ClusterIcon.prototype.getPosFromLatLng_=function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t.x-=this.anchorIcon_[1],t.y-=this.anchorIcon_[0],t.x=parseInt(t.x,10),t.y=parseInt(t.y,10),t},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var e,t=new google.maps.LatLngBounds(this.center_,this.center_),i=this.getMarkers();for(e=0;e<i.length;e++)t.extend(i[e].getPosition());return t},Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},Cluster.prototype.addMarker=function(e){var t,i,s;if(this.isMarkerAlreadyAdded_(e))return!1;if(this.center_){if(this.averageCenter_){var a=this.markers_.length+1,n=(this.center_.lat()*(a-1)+e.getPosition().lat())/a,r=(this.center_.lng()*(a-1)+e.getPosition().lng())/a;this.center_=new google.maps.LatLng(n,r),this.calculateBounds_()}}else this.center_=e.getPosition(),this.calculateBounds_();if(e.isAdded=!0,this.markers_.push(e),i=this.markers_.length,s=this.markerClusterer_.getMaxZoom(),null!==s&&this.map_.getZoom()>s)e.getMap()!==this.map_&&e.setMap(this.map_);else if(i<this.minClusterSize_)e.getMap()!==this.map_&&e.setMap(this.map_);else if(i===this.minClusterSize_)for(t=0;i>t;t++)this.markers_[t].setMap(null);else e.setMap(null);return!0},Cluster.prototype.isMarkerInClusterBounds=function(e){return this.bounds_.contains(e.getPosition())},Cluster.prototype.calculateBounds_=function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e)},Cluster.prototype.updateIcon_=function(){var e=this.markers_.length,t=this.markerClusterer_.getMaxZoom();if(null!==t&&this.map_.getZoom()>t)return void this.clusterIcon_.hide();if(e<this.minClusterSize_)return void this.clusterIcon_.hide();var i=this.markerClusterer_.getStyles().length,s=this.markerClusterer_.getCalculator()(this.markers_,i);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(s),this.clusterIcon_.show()},Cluster.prototype.isMarkerAlreadyAdded_=function(e){for(var t=0,i=this.markers_.length;i>t;t++)if(e===this.markers_[t])return!0;return!1},MarkerClusterer.prototype.onAdd=function(){var e=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){e.resetViewport_(!1),(this.getZoom()===(this.get("minZoom")||0)||this.getZoom()===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){e.redraw_()})]},MarkerClusterer.prototype.onRemove=function(){var e;for(e=0;e<this.markers_.length;e++)this.markers_[e].getMap()!==this.activeMap_&&this.markers_[e].setMap(this.activeMap_);for(e=0;e<this.clusters_.length;e++)this.clusters_[e].remove();for(this.clusters_=[],e=0;e<this.listeners_.length;e++)google.maps.event.removeListener(this.listeners_[e]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){var e,t;if(!(this.styles_.length>0))for(e=0;e<this.imageSizes_.length;e++)t=this.imageSizes_[e],this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t})},MarkerClusterer.prototype.fitMapToMarkers=function(){var e,t=this.getMarkers(),i=new google.maps.LatLngBounds;for(e=0;e<t.length;e++)i.extend(t[e].getPosition());this.getMap().fitBounds(i)},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(e){this.gridSize_=e},MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinimumClusterSize=function(e){this.minClusterSize_=e},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.setMaxZoom=function(e){this.maxZoom_=e},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.setStyles=function(e){this.styles_=e},MarkerClusterer.prototype.getTitle=function(){return this.title_},MarkerClusterer.prototype.setTitle=function(e){this.title_=e},MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.setZoomOnClick=function(e){this.zoomOnClick_=e},MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.setAverageCenter=function(e){this.averageCenter_=e},MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},MarkerClusterer.prototype.setIgnoreHidden=function(e){this.ignoreHidden_=e},MarkerClusterer.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons_},MarkerClusterer.prototype.setEnableRetinaIcons=function(e){this.enableRetinaIcons_=e},MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_},MarkerClusterer.prototype.setImageExtension=function(e){this.imageExtension_=e},MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_},MarkerClusterer.prototype.setImagePath=function(e){this.imagePath_=e},MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_},MarkerClusterer.prototype.setImageSizes=function(e){this.imageSizes_=e},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.setCalculator=function(e){this.calculator_=e},MarkerClusterer.prototype.setHideLabel=function(e){this.hideLabel_=e},MarkerClusterer.prototype.getHideLabel=function(){return this.hideLabel_},MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},MarkerClusterer.prototype.setBatchSizeIE=function(e){this.batchSizeIE_=e},MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_},MarkerClusterer.prototype.setClusterClass=function(e){this.clusterClass_=e},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.getClusters=function(){return this.clusters_},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.addMarker=function(e,t){this.pushMarkerTo_(e),t||this.redraw_()},MarkerClusterer.prototype.addMarkers=function(e,t){var i;for(i in e)e.hasOwnProperty(i)&&this.pushMarkerTo_(e[i]);t||this.redraw_()},MarkerClusterer.prototype.pushMarkerTo_=function(e){if(e.getDraggable()){var t=this;google.maps.event.addListener(e,"dragend",function(){t.ready_&&(this.isAdded=!1,t.repaint())})}e.isAdded=!1,this.markers_.push(e)},MarkerClusterer.prototype.removeMarker=function(e,t,i){var s=!i,a=this.removeMarker_(e,s);return!t&&a&&this.repaint(),a},MarkerClusterer.prototype.removeMarkers=function(e,t,i){var s,a,n=!1,r=!i;for(s=0;s<e.length;s++)a=this.removeMarker_(e[s],r),n=n||a;return!t&&n&&this.repaint(),n},MarkerClusterer.prototype.removeMarker_=function(e,t){var i,s=-1;if(this.markers_.indexOf)s=this.markers_.indexOf(e);else for(i=0;i<this.markers_.length;i++)if(e===this.markers_[i]){s=i;break}return-1!==s&&(t&&e.setMap(null),this.markers_.splice(s,1),!0)},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},MarkerClusterer.prototype.repaint=function(){var e=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){var t;for(t=0;t<e.length;t++)e[t].remove()},0)},MarkerClusterer.prototype.getExtendedBounds=function(e){var t=this.getProjection(),i=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),s=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),a=t.fromLatLngToDivPixel(i);a.x+=this.gridSize_,a.y-=this.gridSize_;var n=t.fromLatLngToDivPixel(s);n.x-=this.gridSize_,n.y+=this.gridSize_;var r=t.fromDivPixelToLatLng(a),o=t.fromDivPixelToLatLng(n);return e.extend(r),e.extend(o),e},MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)},MarkerClusterer.prototype.resetViewport_=function(e){var t,i;for(t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();for(this.clusters_=[],t=0;t<this.markers_.length;t++)i=this.markers_[t],i.isAdded=!1,e&&i.setMap(null)},MarkerClusterer.prototype.distanceBetweenPoints_=function(e,t){var i=6371,s=(t.lat()-e.lat())*Math.PI/180,a=(t.lng()-e.lng())*Math.PI/180,n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2),r=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),o=i*r;return o},MarkerClusterer.prototype.isMarkerInBounds_=function(e,t){return t.contains(e.getPosition())},MarkerClusterer.prototype.addToClosestCluster_=function(e){var t,i,s,a,n=4e4,r=null;for(t=0;t<this.clusters_.length;t++)s=this.clusters_[t],a=s.getCenter(),a&&(i=this.distanceBetweenPoints_(a,e.getPosition()),n>i&&(n=i,r=s));r&&r.isMarkerInClusterBounds(e)?r.addMarker(e):(s=new Cluster(this),s.addMarker(e),this.clusters_.push(s))},MarkerClusterer.prototype.createClusters_=function(e){var t,i,s,a=this;if(this.ready_){0===e&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!=typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),s=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,(-178.48388434375)),new google.maps.LatLng((-85.08136444384544),178.00048865625));var n=this.getExtendedBounds(s),r=Math.min(e+this.batchSize_,this.markers_.length);for(t=e;r>t;t++)i=this.markers_[t],!i.isAdded&&this.isMarkerInBounds_(i,n)&&(!this.ignoreHidden_||this.ignoreHidden_&&i.getVisible())&&this.addToClosestCluster_(i);if(r<this.markers_.length)this.timerRefStatic=setTimeout(function(){a.createClusters_(r)},0);else for(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this),t=0;t<this.clusters_.length;t++)this.clusters_[t].updateIcon_()}},MarkerClusterer.prototype.extend=function(e,t){return function(e){var t;for(t in e.prototype)this.prototype[t]=e.prototype[t];return this}.apply(e,[t])},MarkerClusterer.CALCULATOR=function(e,t){for(var i=0,s="",a=e.length.toString(),n=a;0!==n;)n=parseInt(n/10,10),i++;return i=Math.min(i,t),{text:a,index:i,title:s}},MarkerClusterer.BATCH_SIZE=2e3,MarkerClusterer.BATCH_SIZE_IE=500,MarkerClusterer.IMAGE_PATH="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/images/m",MarkerClusterer.IMAGE_EXTENSION="png",MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90],"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),InfoBox.prototype=new google.maps.OverlayView,InfoBox.prototype.createInfoBoxDiv_=function(){var e,t,i,s=this,a=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},n=function(e){e.returnValue=!1,e.preventDefault&&e.preventDefault(),s.enableEventPropagation_||a(e)};if(!this.div_){if(this.div_=document.createElement("div"),this.setBoxStyle_(),"undefined"==typeof this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(i=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-i.left-i.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),!this.enableEventPropagation_){for(this.eventListeners_=[],t=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],e=0;e<t.length;e++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,t[e],a));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(e){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",n),google.maps.event.trigger(this,"domready")}},InfoBox.prototype.getCloseBoxImg_=function(){var e="";return""!==this.closeBoxURL_&&(e="<img",e+=" src='"+this.closeBoxURL_+"'",e+=" align=right",e+=" style='",e+=" position: relative;",e+=" cursor: pointer;",e+=" margin: "+this.closeBoxMargin_+";",e+="'>"),e},InfoBox.prototype.addClickHandler_=function(){var e;""!==this.closeBoxURL_?(e=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(e,"click",this.getCloseClickHandler_())):this.closeListener_=null},InfoBox.prototype.getCloseClickHandler_=function(){var e=this;return function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(e,"closeclick"),e.close()}},InfoBox.prototype.panBox_=function(e){var t,i,s=0,a=0;if(!e&&(t=this.getMap(),t instanceof google.maps.Map)){t.getBounds().contains(this.position_)||t.setCenter(this.position_),i=t.getBounds();var n=t.getDiv(),r=n.offsetWidth,o=n.offsetHeight,l=this.pixelOffset_.width,d=this.pixelOffset_.height,h=this.div_.offsetWidth,c=this.div_.offsetHeight,p=this.infoBoxClearance_.width,u=this.infoBoxClearance_.height,_=this.getProjection().fromLatLngToContainerPixel(this.position_);if(_.x<-l+p?s=_.x+l-p:_.x+h+l+p>r&&(s=_.x+h+l+p-r),this.alignBottom_?_.y<-d+u+c?a=_.y+d-u-c:_.y+d+u>o&&(a=_.y+d+u-o):_.y<-d+u?a=_.y+d-u:_.y+c+d+u>o&&(a=_.y+c+d+u-o),0!==s||0!==a){t.getCenter();t.panBy(s,a)}}},InfoBox.prototype.setBoxStyle_=function(){var e,t;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",t=this.boxStyle_;for(e in t)t.hasOwnProperty(e)&&(this.div_.style[e]=t[e]);this.div_.style.WebkitTransform="translateZ(0)","undefined"!=typeof this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*this.div_.style.opacity+')"',this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},InfoBox.prototype.getBoxWidths_=function(){var e,t={top:0,bottom:0,left:0,right:0},i=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(e=i.ownerDocument.defaultView.getComputedStyle(i,""),e&&(t.top=parseInt(e.borderTopWidth,10)||0,t.bottom=parseInt(e.borderBottomWidth,10)||0,t.left=parseInt(e.borderLeftWidth,10)||0,t.right=parseInt(e.borderRightWidth,10)||0)):document.documentElement.currentStyle&&i.currentStyle&&(t.top=parseInt(i.currentStyle.borderTopWidth,10)||0,t.bottom=parseInt(i.currentStyle.borderBottomWidth,10)||0,t.left=parseInt(i.currentStyle.borderLeftWidth,10)||0,t.right=parseInt(i.currentStyle.borderRightWidth,10)||0),t},InfoBox.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var e=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=e.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(e.y+this.pixelOffset_.height)+"px":this.div_.style.top=e.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible"},InfoBox.prototype.setOptions=function(e){"undefined"!=typeof e.boxClass&&(this.boxClass_=e.boxClass,this.setBoxStyle_()),"undefined"!=typeof e.boxStyle&&(this.boxStyle_=e.boxStyle,this.setBoxStyle_()),"undefined"!=typeof e.content&&this.setContent(e.content),"undefined"!=typeof e.disableAutoPan&&(this.disableAutoPan_=e.disableAutoPan),"undefined"!=typeof e.maxWidth&&(this.maxWidth_=e.maxWidth),"undefined"!=typeof e.pixelOffset&&(this.pixelOffset_=e.pixelOffset),"undefined"!=typeof e.alignBottom&&(this.alignBottom_=e.alignBottom),"undefined"!=typeof e.position&&this.setPosition(e.position),"undefined"!=typeof e.zIndex&&this.setZIndex(e.zIndex),"undefined"!=typeof e.closeBoxMargin&&(this.closeBoxMargin_=e.closeBoxMargin),"undefined"!=typeof e.closeBoxURL&&(this.closeBoxURL_=e.closeBoxURL),"undefined"!=typeof e.infoBoxClearance&&(this.infoBoxClearance_=e.infoBoxClearance),"undefined"!=typeof e.isHidden&&(this.isHidden_=e.isHidden),"undefined"!=typeof e.visible&&(this.isHidden_=!e.visible),"undefined"!=typeof e.enableEventPropagation&&(this.enableEventPropagation_=e.enableEventPropagation),this.div_&&this.draw()},InfoBox.prototype.setContent=function(e){this.content_=e,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),"undefined"==typeof e.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px","undefined"==typeof e.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},InfoBox.prototype.setPosition=function(e){this.position_=e,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},InfoBox.prototype.setZIndex=function(e){this.zIndex_=e,this.div_&&(this.div_.style.zIndex=e),google.maps.event.trigger(this,"zindex_changed")},InfoBox.prototype.setVisible=function(e){this.isHidden_=!e,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible")},InfoBox.prototype.getContent=function(){return this.content_},InfoBox.prototype.getPosition=function(){return this.position_},InfoBox.prototype.getZIndex=function(){return this.zIndex_},InfoBox.prototype.getVisible=function(){var e;return e="undefined"!=typeof this.getMap()&&null!==this.getMap()&&!this.isHidden_},InfoBox.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},InfoBox.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},InfoBox.prototype.open=function(e,t){var i=this;t&&(this.position_=t.getPosition(),this.moveListener_=google.maps.event.addListener(t,"position_changed",function(){i.setPosition(this.getPosition())})),this.setMap(e),this.div_&&this.panBox_()},InfoBox.prototype.close=function(){var e;if(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListeners_){for(e=0;e<this.eventListeners_.length;e++)google.maps.event.removeListener(this.eventListeners_[e]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)},function(){"use strict";IntelDCC.api={},IntelDCC.api.devices=[],IntelDCC.map={},IntelDCC.map.markers=[],IntelDCC.map.canvas=null,IntelDCC.map.clusterManager=null,IntelDCC.map.infobox={},IntelDCC.map.infobox.canvas=null,IntelDCC.map.defaultLatitude=53.33,IntelDCC.map.defaultLongitude=-6.25,$(document).ready(function(){IntelDCC.map.eventListeners()}),IntelDCC.map.eventListeners=function(){$(document).on("click","#sort-device-list-by-distance",function(){IntelDCC.api.sortDevicesByDistance(this)}),$(document).on("click","#sort-device-list-by-urgency",function(){IntelDCC.api.sortDevicesByUrgency(this)}),$(document).on("click","#sort-device-list-by-time",function(){IntelDCC.api.sortDevicesByTime(this)}),$(document).on("click","[data-accordion-header]",function(){IntelDCC.map.toggleAccordion(this)}),$(document).on("change","[data-device-details-tab]",function(){IntelDCC.map.switchDeviceListTab(this)}),$(document).on("change","[data-device-details-filter]",function(){IntelDCC.map.switchDeviceListFilter(this)}),google.maps.event.addDomListener(window,"load",IntelDCC.map.initialise),google.maps.event.addDomListener(window,"resize",IntelDCC.map.resized)},IntelDCC.map.initialise=function(){var e=document.getElementById("google-map-placeholder");IntelDCC.map.canvas=new google.maps.Map(e,{center:{lat:IntelDCC.map.defaultLatitude,lng:IntelDCC.map.defaultLongitude},disableDefaultUI:!0,zoomControl:!0,panControl:!0,zoom:12,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]}),IntelDCC.map.downloadData(),IntelDCC.map.infobox.initialise(),IntelDCC.map.canvas.addListener("zoom_changed",IntelDCC.map.zoomChanged)},IntelDCC.map.resized=function(){IntelDCC.map.infobox.canvas&&IntelDCC.map.infobox.canvas.getVisible()===!1&&IntelDCC.map.canvas.setCenter(new google.maps.LatLng(IntelDCC.map.defaultLatitude,IntelDCC.map.defaultLongitude))},IntelDCC.map.zoomChanged=function(){var e=60;IntelDCC.map.canvas.getZoom()<=11&&(e/=2),IntelDCC.map.markers.forEach(function(e){})},IntelDCC.map.infobox.initialise=function(){var e={closeBoxURL:"",pane:"floatPane",alignBottom:!0,enableEventPropagation:!1,pixelOffset:new google.maps.Size((-300),(-80)),infoBoxClearance:new google.maps.Size(30,40),boxStyle:{width:"640px"}};IntelDCC.map.infobox.canvas=new InfoBox(e),IntelDCC.map.infobox.canvas.addListener("domready",function(){$("[data-infobox-close]").on("click",function(){IntelDCC.map.infobox.canvas.close(),IntelDCC.map.infobox.canvas.setContent("")}),$("[data-infobox-tab]").on("change",function(){IntelDCC.map.infobox.switchTab(this)}),$("[data-infobox-filter]").on("change",function(){IntelDCC.map.infobox.switchFilter(this)}),$("[data-simulate-tip]").on("click",function(e){IntelDCC.map.infobox.simulateTip(this),e.preventDefault()}),$("[data-infobox-report-link]").on("click",function(e){e.preventDefault(),IntelDCC.map.infobox.reportLinkClicked(this),e.preventDefault()}),IntelDCC.map.infobox.switchTab($("[data-infobox-tab]:checked"))})},IntelDCC.map.downloadData=function(){$("#intel-api-loading-icon").show(),$.post("api/get-devices.php",function(e){IntelDCC.map.infobox.canvas.close(),IntelDCC.map.infobox.canvas.setContent(""),IntelDCC.map.clusterManager&&IntelDCC.map.clusterManager.clearMarkers(),IntelDCC.map.markers=[],IntelDCC.api.devices=e,IntelDCC.map.switchSortTab(),IntelDCC.map.generateDeviceList(),IntelDCC.map.generateDeviceMarkers(),$("#intel-api-loading-icon").hide(),setTimeout(function(){IntelDCC.map.downloadData()},3e5)})},IntelDCC.map.generateDeviceList=function(){var e=document.getElementById("device-list-items");e.innerHTML="";for(var t=0;t<IntelDCC.api.devices.length;t++){var i=IntelDCC.api.devices[t],s=i.group.groupId,a=i.data.deviceId,n=i.data.sensorList.split(", "),r=i.hasOwnProperty("primarySensorID")?i.primarySensorID:IntelDCC.map.getPrimarySensorID(i),o="";o+='<div class="accordion__panel" data-accordion>',o+='<div class="accordion__panel__header" data-accordion-header>',o+='<div class="device-summary" data-group-id="'+s+'" data-device-id="'+a+'">',o+='<div class="device-summary__section">',o+='<img class="device-summary__status" src="'+IntelDCC.map.getSensorIconURL(i.alerts,r)+'">',o+="</div>",o+='<div class="device-summary__section">',o+='<h3 class="device-summary__heading">'+i.data.displayName+"</h3>",o+='<p class="device-summary__description">Last updated: '+moment(i.data.timeStamp).format("DD/MM/YYYY, h:mm:ss a")+"</p>",o+="</div>",o+="</div>",o+="</div>",o+='<div class="accordion__panel__content" data-accordion-content>',o+='<div class="device-details" data-device-id="'+a+'" data-group-id="'+s+'" data-device-details>',o+='<div class="device-details__tabs">';for(var l=0;l<n.length;l++){var d="",h="sensor-tab__icon "+IntelDCC.map.getSensorTabClass(n[l]);0===l&&(d+='checked="checked"'),o+='<label class="sensor-tab" title="'+n[l]+'">',o+='<input type="radio" class="sensor-tab__radio" name="device-list-tab-'+t+'" data-sensor-id="'+n[l]+'" '+d+" data-device-details-tab>",o+='<span class="'+h+'"></span>',o+="</label>"}o+="</div>",o+='<div class="device-details__slides">';for(var c=0;c<n.length;c++){var p=n[c];o+='<div class="device-details__slide" data-sensor-id="'+p+'" data-device-details-slide>',o+='<div class="responsive-chart" data-responsive-chart>',o+='<h3 class="responsive-chart__title" data-chart-title>&nbsp;</h3>',o+='<div class="responsive-chart__container">',o+='<canvas class="responsive-chart__canvas">',o+="</div>",o+="</div>",o+='<div class="device-details__filters">',"RAINFALL"===IntelDCC.getSensorType(p)?(o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="24h" data-interval-filter="raw" data-device-details-filter checked>',o+="<span>Raw</span>",o+="</label>",o+="</div>",o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="3h" data-interval-filter="5m" data-device-details-filter>',o+="<span>5 min</span>",o+="</label>",o+="</div>",o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',
o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="3h" data-interval-filter="15m" data-device-details-filter>',o+="<span>15 min</span>",o+="</label>",o+="</div>",o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="24h" data-interval-filter="24h" data-device-details-filter>',o+="<span>Hourly Total</span>",o+="</label>",o+="</div>"):(o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="24h" data-interval-filter="raw" data-device-details-filter checked>',o+="<span>Raw</span>",o+="</label>",o+="</div>",o+='<div class="standard-radio">',o+='<label class="standard-radio__label">',o+='<input type="radio" class="standard-radio__input" name="device-list-filter-'+a+"-"+p+'" data-period-filter="24h" data-interval-filter="24h" data-device-details-filter>',o+="<span>Hourly Total</span>",o+="</label>",o+="</div>"),o+="</div>",o+="</div>"}o+="</div>",o+="</div>",o+="</div>",e.innerHTML+=o}},IntelDCC.map.getSensorIconURL=function(e,t){var i="images/alerts/broken.gif",s=IntelDCC.map.getSensorAlertLevel(e,t);return"RAINFALL"===IntelDCC.getSensorType(t)?i="images/alerts/rain-"+s+".gif":"RIVER_LEVEL"===IntelDCC.getSensorType(t)&&(i="images/alerts/river-level-"+s+".gif"),i},IntelDCC.map.getPrimarySensorID=function(e){for(var t="",i=1,s=e.data.sensorList.split(", "),a=0;a<s.length;a++){var n=s[a];""===t&&(t=n);var r=IntelDCC.map.getSensorAlertLevel(e.alerts,n);r>=i&&(t=n,i=r)}return e.primarySensorID=t,e.highestAlertLevel=i,t},IntelDCC.map.getSensorAlertLevel=function(e,t){for(var i=1,s=0;s<e.length;s++)e[s].sensorId===t&&e[s].alertLevel>=i&&(i=e[s].alertLevel);return i},IntelDCC.map.getSensorTabClass=function(e){var t="";return"RAINFALL"===IntelDCC.getSensorType(e)?t="sensor-tab__icon--rain":"RIVER_LEVEL"===IntelDCC.getSensorType(e)&&(t="sensor-tab__icon--river-level"),t},IntelDCC.map.generateDeviceMarkers=function(){for(var e=0;e<IntelDCC.api.devices.length;e++){var t=IntelDCC.api.devices[e],i=(t.data.sensorList.split(", "),t.hasOwnProperty("primarySensorID")?t.primarySensorID:IntelDCC.map.getPrimarySensorID(t)),s=IntelDCC.map.getSensorIconURL(t.alerts,i),a=new google.maps.MarkerImage(s,null,null,null,new google.maps.Size(60,60)),n=null;n=t.data.lat&&t.data.lng?new google.maps.LatLng(t.data.lat,t.data.lng):new google.maps.LatLng(t.data.deviceLat,t.data.deviceLng);var r=new google.maps.Marker({position:n,icon:a,optimized:!1,map:IntelDCC.map.canvas,title:t.data.displayName});r.device=IntelDCC.api.devices[e],IntelDCC.map.markers.push(r),google.maps.event.addListener(r,"click",function(){IntelDCC.map.infobox.generate(this),IntelDCC.map.infobox.canvas.open(IntelDCC.map.canvas,this)})}var o=[{url:"images/alerts/blank-1.gif",width:60,height:60,textColor:"white",textSize:22},{url:"images/alerts/blank-2.gif",width:60,height:60,textColor:"white",textSize:22},{url:"images/alerts/blank-3.gif",width:60,height:60,textColor:"white",textSize:22},{url:"images/alerts/blank-4.gif",width:60,height:60,textColor:"white",textSize:22}];IntelDCC.map.clusterManager=new MarkerClusterer(IntelDCC.map.canvas,IntelDCC.map.markers,{enableRetinaIcons:!0,styles:o,gridSize:70}),IntelDCC.map.clusterManager.setCalculator(function(e){var t=1;return e.length>1&&e.forEach(function(e){e.device.highestAlertLevel>t&&(t=e.device.highestAlertLevel)}),{text:e.length,index:t,title:"Alert Level "+t}})},IntelDCC.map.infobox.generate=function(e){var t=e.device,i=t.group.groupId,s=t.data.deviceId,a=t.data.sensorList.split(", "),n=document.createElement("input");n.type="button",n.className="infobox__close",n.setAttribute("data-infobox-close","");var r=document.createElement("div");r.className="infobox__tabs";var o=document.createElement("div");o.className="infobox__slides";for(var l=0;l<a.length;l++){var d=a[l],h=document.createElement("input");h.type="radio",h.name="infobox-sensor-tabs",h.className="sensor-tab__radio",h.setAttribute("data-sensor-id",d),h.setAttribute("data-infobox-tab","");var c=document.createElement("span");c.className="sensor-tab__icon "+IntelDCC.map.getSensorTabClass(d);var p=document.createElement("label");p.title=d,p.className="sensor-tab",p.appendChild(h),p.appendChild(c),0===l&&(h.checked="true"),r.appendChild(p);var u=document.createElement("div");u.className="infobox__slide",u.setAttribute("data-infobox-slide",""),u.setAttribute("data-sensor-id",d),0===l&&(u.className+=" infobox__slide--visible"),o.appendChild(u);var _=document.createElement("div");_.className="infobox__header",_.innerHTML+='<h3 class="infobox__heading">'+t.data.displayName+"</h3>",_.innerHTML+='<p class="infobox__description">Last updated: '+moment(t.data.timeStamp).format("DD/MM/YYYY, h:mm:ss a")+"</p>";var f=document.createElement("div");f.className="infobox__chart-container",f.setAttribute("data-responsive-chart",""),f.innerHTML+='<h3 class="infobox__chart-title" data-chart-title>&nbsp;</h3><div class="infobox__chart"><canvas class="infobox__canvas"></div>';var g=document.createElement("div");g.className="infobox__filters","RAINFALL"===IntelDCC.getSensorType(d)?g.innerHTML+='<div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="24h" data-interval-filter="raw" data-infobox-filter checked><span>Raw</span</label></div><div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="3h" data-interval-filter="5m" data-infobox-filter><span>5 min</span</label></div><div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="3h" data-interval-filter="15m" data-infobox-filter><span>15 min</span</label></div><div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="24h" data-interval-filter="24h" data-infobox-filter><span>Hourly Total</span</label></div>':g.innerHTML+='<div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="24h" data-interval-filter="raw" data-infobox-filter checked><span>Raw</span</label></div><div class="standard-radio"><label class="standard-radio__label"><input type="radio" class="standard-radio__input" name="infobox-chart-filter-'+s+"-"+d+'" data-period-filter="24h" data-interval-filter="24h" data-infobox-filter><span>Hourly Total</span</label></div>';var m="Alert: ",v=IntelDCC.map.getSensorAlertLevel(t.alerts,d);"RAINFALL"===IntelDCC.getSensorType(d)?m+="Rainfall alarm "+v:"RIVER_LEVEL"===IntelDCC.getSensorType(d)&&(m+="River level alarm "+v);var C=document.createElement("div");C.className="infobox__status",C.innerHTML='<div class="infobox__status__column"><h2 class="infobox__status__heading">Alert Status:</h2></div><div class="infobox__status__column"><img class="infobox__status__icon" src="'+IntelDCC.map.getSensorIconURL(t.alerts,d)+'"></div><div class="infobox__status__column infobox__status__column--stretch"><p class="infobox__status__description infobox__status__description--'+v+'">'+m+"</p></div>",u.appendChild(_),u.appendChild(f),u.appendChild(g),u.appendChild(C)}var y="reporting.php?group-id="+i+"&device-id="+s,x="device-manager.php?group-id="+i+"&device-id="+s,b=document.createElement("div");if(b.className="infobox__footer","bc5f667c-4af7-4386-a12d-4263fb51841d"===i){var I="api/simulate-tip.php?deviceID="+s+"&sensorID="+t.primarySensorID;b.innerHTML+='<div class="infobox__footer__lhs"><a href="'+I+'" class="infobox__footer__link infobox__footer__link--no-margin" data-simulate-tip>Simulate Tip (0.2mm)</a></div>'}b.innerHTML+='<a href="'+y+'" class="infobox__footer__link" data-infobox-report-link>Reporting</a>',b.innerHTML+='<a href="'+x+'" class="infobox__footer__link">Manage Sensors</a>';var k=document.createElement("div");k.className="infobox__column",k.appendChild(n),k.appendChild(o),k.appendChild(b);var M=document.createElement("div");M.className="infobox__column infobox__column--tabs",M.appendChild(r);var D=document.createElement("div");D.className="infobox",D.setAttribute("data-group-id",i),D.setAttribute("data-device-id",s),D.setAttribute("data-infobox",""),D.appendChild(k),D.appendChild(M),IntelDCC.map.infobox.canvas.setContent(D)},IntelDCC.map.infobox.switchTab=function(e){var t=$(e).closest("[data-infobox]"),i=$(t).attr("data-group-id"),s=$(t).attr("data-device-id"),a=$(e).attr("data-sensor-id"),n=$(t).find('[data-infobox-slide][data-sensor-id="'+a+'"]'),r=$(n).find("[data-infobox-filter]:checked").attr("data-period-filter"),o=$(n).find("[data-infobox-filter]:checked").attr("data-interval-filter"),l=$(n).find("canvas").get(0);$(t).find("[data-infobox-slide]").removeClass("infobox__slide--visible"),$(n).addClass("infobox__slide--visible"),IntelDCC.charts.downloadSensorData(i,s,a,r,o,null,null).then(function(e){IntelDCC.charts.drawChart(e,l)})},IntelDCC.map.infobox.switchFilter=function(e){var t=$(e).closest("[data-infobox]"),i=$(t).find("[data-infobox-tab]:checked"),s=$(t).attr("data-group-id"),a=$(t).attr("data-device-id"),n=$(i).attr("data-sensor-id"),r=$(e).attr("data-period-filter"),o=$(e).attr("data-interval-filter"),l=$(t).find('[data-infobox-slide][data-sensor-id="'+n+'"]'),d=$(l).find("canvas").get(0);IntelDCC.charts.downloadSensorData(s,a,n,r,o,null,null).then(function(e){IntelDCC.charts.drawChart(e,d)})},IntelDCC.map.infobox.simulateTip=function(e){$(e).addClass("infobox__footer__link--disabled"),$.post(e.href,function(t){"success"===t.result&&setTimeout(function(){$(e).removeClass("infobox__footer__link--disabled"),IntelDCC.map.infobox.switchTab($("[data-infobox-tab]:checked"))},2e3)})},IntelDCC.map.infobox.reportLinkClicked=function(e){var t=$(e).closest("[data-infobox]"),i=$(t).find(".infobox__slide--visible"),s=$(i).find("[data-infobox-filter]:checked").attr("data-period-filter"),a=$(i).find("[data-infobox-filter]:checked").attr("data-interval-filter");window.location.href=e.href+"&period="+s+"&interval="+a},IntelDCC.map.toggleAccordion=function(e){var t=$(e).closest("[data-accordion]"),i=$(t).find("[data-accordion-content]"),s=$(i).find("[data-device-details-tab]:checked");if(i.toggle(),$(i).is(":visible")){var a=$("#site-header").height();IntelDCC.scrollTo($(t).offset().top-a)}IntelDCC.map.switchDeviceListTab(s)},IntelDCC.map.switchDeviceListTab=function(e){var t=$(e).closest("[data-device-details]"),i=$(t).attr("data-group-id"),s=$(t).attr("data-device-id"),a=$(e).attr("data-sensor-id"),n=$(t).find('[data-device-details-slide][data-sensor-id="'+a+'"]'),r=$(n).find("[data-device-details-filter]:checked").attr("data-period-filter"),o=$(n).find("[data-device-details-filter]:checked").attr("data-interval-filter"),l=$(n).find("canvas").get(0);$(t).find("[data-device-details-slide]").removeClass("device-details__slide--visible"),$(n).addClass("device-details__slide--visible"),IntelDCC.charts.downloadSensorData(i,s,a,r,o,null,null).then(function(e){IntelDCC.charts.drawChart(e,l)})},IntelDCC.map.switchDeviceListFilter=function(e){var t=$(e).closest("[data-device-details]"),i=$(t).find("[data-device-details-tab]:checked"),s=$(t).attr("data-group-id"),a=$(t).attr("data-device-id"),n=$(i).attr("data-sensor-id"),r=$(e).attr("data-period-filter"),o=$(e).attr("data-interval-filter"),l=$(t).find('[data-device-details-slide][data-sensor-id="'+n+'"]'),d=$(l).find("canvas").get(0);IntelDCC.charts.downloadSensorData(s,a,n,r,o,null,null).then(function(e){IntelDCC.charts.drawChart(e,d)})},IntelDCC.map.switchSortTab=function(e){$(e).addClass("device-list__sort__button--active"),$(".device-list__sort__button").not(e).removeClass("device-list__sort__button--active")},IntelDCC.api.sortDevicesByDistance=function(e){IntelDCC.api.devices.length>0&&"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(t){var i=t.coords.latitude,s=t.coords.longitude;IntelDCC.map.defaultLatitude=i,IntelDCC.map.defaultLongitude=s;for(var a=0;a<IntelDCC.api.devices.length;a++){var n=IntelDCC.api.devices[a];n.deviceDistance=4e4,n.data.lat&&n.data.lng&&(n.deviceDistance=IntelDCC.charts.getDistanceBetweenLatLngs(i,s,n.data.lat,n.data.lng))}IntelDCC.api.devices.sort(firstBy(function(e){return e.data.displayName},-1)),IntelDCC.api.devices.sort(firstBy(function(e){return e.deviceDistance})),IntelDCC.map.switchSortTab(e),IntelDCC.map.generateDeviceList()})},IntelDCC.api.sortDevicesByUrgency=function(e){IntelDCC.api.devices.length>0&&(IntelDCC.api.devices.sort(firstBy(function(e){return e.data.displayName},-1)),IntelDCC.api.devices.sort(firstBy(function(e){return e.highestAlertLevel},-1)),IntelDCC.map.switchSortTab(e),IntelDCC.map.generateDeviceList())},IntelDCC.api.sortDevicesByTime=function(e){IntelDCC.api.devices.length>0&&(IntelDCC.api.devices.sort(firstBy(function(e){return e.data.displayName},-1)),IntelDCC.api.devices.sort(firstBy(function(e){return e.data.timeStamp},-1)),IntelDCC.map.switchSortTab(e),IntelDCC.map.generateDeviceList())}}();