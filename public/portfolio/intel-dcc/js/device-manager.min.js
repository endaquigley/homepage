!function(){"use strict";IntelDCC.api={},IntelDCC.api.groups=[],IntelDCC.deviceManager={},$(document).ready(function(){IntelDCC.deviceManager.eventListeners(),IntelDCC.deviceManager.downloadData()}),IntelDCC.deviceManager.eventListeners=function(){$("#sensor-selector-groups").on("change",function(){IntelDCC.deviceManager.groupChanged()}),$("#sensor-selector-devices").on("change",function(){IntelDCC.deviceManager.deviceChanged()}),$("#sensor-selector-sensors").on("change",function(){IntelDCC.deviceManager.sensorChanged()}),$("#device-manager-save").on("click",function(){IntelDCC.deviceManager.saveDevice()})},IntelDCC.deviceManager.downloadData=function(){$("#intel-api-loading-icon").show(),$.post("api/get-groups.php",function(e){IntelDCC.api.groups=e,IntelDCC.deviceManager.populateGroupDropdown(),IntelDCC.deviceManager.processQueryString(),IntelDCC.deviceManager.populateDeviceDropdown(),IntelDCC.deviceManager.processQueryString(),IntelDCC.deviceManager.populateSensorDropdown(),IntelDCC.deviceManager.autoSelectCheck("#sensor-selector-sensors"),$("#intel-api-loading-icon").hide()})},IntelDCC.deviceManager.populateGroupDropdown=function(){var e=document.getElementById("sensor-selector-groups");IntelDCC.resetDropdown(e,!0),IntelDCC.api.groups.forEach(function(a,t){var n=document.createElement("option");n.text=a.data.groupName,n.value=a.data.groupId,e.appendChild(n)}),$(e).val("")},IntelDCC.deviceManager.populateDeviceDropdown=function(){var e=document.getElementById("sensor-selector-devices");IntelDCC.resetDropdown(e,!0);var a=IntelDCC.deviceManager.getSelectedGroup();a&&a.devices.forEach(function(a,t){var n=document.createElement("option");n.text=a.data.displayName,n.value=a.data.deviceId,e.appendChild(n)}),$(e).val("")},IntelDCC.deviceManager.populateSensorDropdown=function(){var e=document.getElementById("sensor-selector-sensors");IntelDCC.resetDropdown(e,!0);var a=IntelDCC.deviceManager.getSelectedDevice();if(a){var t=a.data.sensorList.split(", ");t.forEach(function(a,t){var n=document.createElement("option");n.text=a,n.value=a,e.appendChild(n)})}$(e).val("")},IntelDCC.deviceManager.getSelectedGroup=function(){var e=null,a=document.getElementById("sensor-selector-groups");if(a.selectedIndex>=0){var t=a.options[a.selectedIndex].value;IntelDCC.api.groups.forEach(function(a,n){t===a.data.groupId&&(e=a)})}return e},IntelDCC.deviceManager.getSelectedDevice=function(){var e=null,a=document.getElementById("sensor-selector-devices"),t=IntelDCC.deviceManager.getSelectedGroup();if(t&&a.selectedIndex>=0){var n=a.options[a.selectedIndex].value;t.devices.forEach(function(a,t){n===a.data.deviceId&&(e=a)})}return e},IntelDCC.deviceManager.processQueryString=function(){var e=IntelDCC.getParameterByName("group-id"),a=IntelDCC.getParameterByName("device-id");$("#sensor-selector-groups option").each(function(){$(this).val()===e&&$(this).prop("selected",!0)}),$("#sensor-selector-devices option").each(function(){$(this).val()===a&&$(this).prop("selected",!0)})},IntelDCC.deviceManager.groupChanged=function(){$("#sensor-selector-groups").val();IntelDCC.deviceManager.resetThresholdFields(),IntelDCC.resetDropdown("#sensor-selector-devices",!0),IntelDCC.resetDropdown("#sensor-selector-sensors",!0),IntelDCC.deviceManager.populateDeviceDropdown(),IntelDCC.deviceManager.autoSelectCheck("#sensor-selector-devices")},IntelDCC.deviceManager.deviceChanged=function(){$("#sensor-selector-groups").val(),$("#sensor-selector-devices").val();IntelDCC.deviceManager.resetThresholdFields(),IntelDCC.resetDropdown("#sensor-selector-sensors",!0),IntelDCC.deviceManager.populateSensorDropdown(),IntelDCC.deviceManager.autoSelectCheck("#sensor-selector-sensors"),IntelDCC.api.getSensorData()},IntelDCC.deviceManager.sensorChanged=function(){IntelDCC.deviceManager.resetThresholdFields();var e=$("#sensor-selector-sensors").val(),a=$("#device-manager-alert-type"),t=$("[data-threshold-duration]");"RAINFALL"===IntelDCC.getSensorType(e)&&(t.removeClass("standard-input--disabled"),t.removeAttr("disabled"),a.val("Rainfall")),"RAINFALL"===IntelDCC.getSensorType(e)?($("[data-threshold-value-unit]").html("(mm)"),$("[data-threshold-duration-unit]").html("(mins)")):"RIVER_LEVEL"===IntelDCC.getSensorType(e)&&($("[data-threshold-value-unit]").html("(m)"),$("[data-threshold-duration-unit]").html("(mins)")),IntelDCC.api.getSensorData()},IntelDCC.deviceManager.resetThresholdFields=function(){$("#device-manager-alert-type").val("Threshold"),$("#calibration-offset").val("0"),$("[data-threshold-value-unit]").html(""),$("[data-threshold-duration-unit]").html(""),$("[data-threshold-value]").val(""),$("[data-threshold-duration]").val("0"),$("[data-threshold-duration]").addClass("standard-input--disabled"),$("[data-threshold-duration]").attr("disabled","disabled")},IntelDCC.resetDropdown=function(e,a){$(e).val(""),$(e)[0].selectedIndex=-1,a&&$(e).empty()},IntelDCC.deviceManager.autoSelectCheck=function(e){var a=$(e).find("option");1===a.length&&(a.prop("selected",!0),$(e).trigger("change"))},IntelDCC.api.getSensorData=function(){var e=$("#sensor-selector-groups").val(),a=$("#sensor-selector-devices").val(),t=$("#sensor-selector-sensors").val();e&&a&&t&&($("#intel-api-loading-icon").show(),$.post("api/get-alert-settings.php",{groupID:e,deviceID:a,sensorID:t},function(e){var a=null,n=e;n.forEach(function(e,n){e.sensorId===t&&(a=e)}),a&&($('[data-threshold-value="1"]').val(a.value1),$('[data-threshold-value="2"]').val(a.value2),$('[data-threshold-value="3"]').val(a.value3),$('[data-threshold-value="4"]').val(a.value4),$('[data-threshold-duration="1"]').val(a.duration1),$('[data-threshold-duration="2"]').val(a.duration2),$('[data-threshold-duration="3"]').val(a.duration3),$('[data-threshold-duration="4"]').val(a.duration4)),$("#intel-api-loading-icon").hide()}))},IntelDCC.deviceManager.saveDevice=function(){var e="",a=$("#sensor-selector-groups").val(),t=$("#sensor-selector-devices").val(),n=$("#sensor-selector-sensors").val(),o=$("#device-manager-alert-type").val(),r=($("#calibration-offset").val(),$('[data-threshold-value="1"]').val()),l=$('[data-threshold-value="2"]').val(),s=$('[data-threshold-value="3"]').val(),d=$('[data-threshold-value="4"]').val(),i=$('[data-threshold-duration="1"]').val(),c=$('[data-threshold-duration="2"]').val(),v=$('[data-threshold-duration="3"]').val(),u=$('[data-threshold-duration="4"]').val();if(a&&t&&n){$("#intel-api-loading-icon").show();var C=$("#device-manager-save");C.attr("disabled","disabled"),$.post("api/set-alert-settings.php",{groupID:a,deviceID:t,sensorID:n,alertType:o,comment:e,value1:r,duration1:i,value2:l,duration2:c,value3:s,duration3:v,value4:d,duration4:u},function(e){IntelDCC.scrollTo(0),$("#intel-api-loading-icon").hide();var a=$("#page-notification");a.addClass("page-notification--show"),setTimeout(function(){C.removeAttr("disabled"),a.removeClass("page-notification--show")},4e3)})}}}();